CMAKE_MINIMUM_REQUIRED(VERSION 3.0)
PROJECT(Romeo LANGUAGES CXX)

FOREACH (POLICY_LIST
        CMP0071 # 3.10: Let AUTOMOC and AUTOUIC process GENERATED files
        )
    IF (POLICY ${POLICY_LIST})
        CMAKE_POLICY(SET ${POLICY_LIST} NEW)
    ENDIF ()
ENDFOREACH ()

# 资源文件
FILE(GLOB RESOURCES ${RES_PATH}/*.qrc)
FILE(GLOB UIS ${UI_PATH}/*.ui)

QT5_WRAP_UI(UI_HEADERS ${UIS})
QT5_ADD_RESOURCES(RES_SOURCES ${RESOURCES})

# 多国语言支持
SET(TRANS ${LANG_PATH}/lang_zh.ts)

# 源码
SET(CODE_SOURCES RomeoGUI.cpp)      # Main
SET(CODE_SOURCES ${CODE_SOURCES}    # Model
        Model/GScanner.cpp
        Model/FFModel.cpp
        Model/PredictModel.cpp
        Model/Tuple4Model.cpp
        )
SET(CODE_SOURCES ${CODE_SOURCES}    # View
        View/MainWindow.cpp
        )
SET(CODE_SOURCES ${CODE_SOURCES}    # Controller
        )
SET(CODE_SOURCES ${CODE_SOURCES}    # Utils
        )

# 设置输出目录
SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)

# 编译
QT5_CREATE_TRANSLATION(LANGS ${UIS} ${TRANS} ${CODE_SOURCES} ${UI_HEADERS})

INCLUDE_DIRECTORIES(Qt5Core_INCLUDE_DIRS)
INCLUDE_DIRECTORIES(Qt5Widgets_INCLUDE_DIRS)

if (${NO_CONSOLE} STREQUAL ON)
    ADD_EXECUTABLE(${PROJECT_NAME}GUI WIN32
            ${CODE_SOURCES} ${RES_SOURCES} ${UI_HEADERS} ${LANGS} ${ICON})
else ()
    ADD_EXECUTABLE(${PROJECT_NAME}GUI
            ${CODE_SOURCES} ${RES_SOURCES} ${UI_HEADERS} ${LANGS} ${ICON})
endif ()
SET_DIRECTORY_PROPERTIES(PROPERTIES CLEAN_NO_CUSTOM TRUE)

# 转移翻译文件
FILE(GLOB LANG_FILE ${CMAKE_CURRENT_BINARY_DIR}/*.qm)
FILE(COPY ${LANG_FILE} DESTINATION ${CMAKE_BINARY_DIR}/bin/lang)

# 链接
TARGET_LINK_LIBRARIES(${PROJECT_NAME}GUI PRIVATE RomeoLang Qt5::Core Qt5::Widgets)

# MSVC UTF-8支持
if (MSVC)
    set_target_properties(${PROJECT_NAME}GUI PROPERTIES COMPILE_FLAGS /utf-8)
endif ()
